# .NET 10.0 Cloud-Native Web API Template

![.NET 10.0](https://img.shields.io/badge/.NET-10.0-512BD4)
![Architecture](https://img.shields.io/badge/Architecture-Modular%20Monolith-blue)
![License](https://img.shields.io/badge/License-MIT-green)

**A strictly "Native First," modular, and high-performance Web API solution template designed for enterprise scale.**

This repository demonstrates a production-ready architecture that minimizes third-party dependencies by leveraging the full power of the .NET 10.0 ecosystem. It adheres to a strict **Separation of Concerns (SoC)** through a unique Composition Root pattern, ensuring business logic remains pure while infrastructure concerns scale independently.

---

## ðŸ— Architecture & Design Philosophy

The solution is architected as a **Modular Monolith**. Infrastructure concerns are isolated into specialized `Shared.*` libraries, which are wired together by a single "Composition" library.

### Key Conventions
1.  **Native First**: We prioritize `Microsoft.Extensions.*` libraries over third-party packages (e.g., `System.Text.Json` > Newtonsoft, `Microsoft.Extensions.Http.Resilience` > Raw Polly).
2.  **Centralized Composition**: The API project (`TemplateApi`) does not know about Redis, OpenTelemetry, or Security specifics. It simply calls `AddInfrastructure()`.
3.  **Distributed by Design**: All modules (Caching, Security, Resilience) are configured to work in multi-instance (Kubernetes) environments out of the box.
4.  **AOT Readiness**: The code avoids dynamic proxy generation where possible, using Source Generators to support Native AOT compilation.

---

## ðŸ§© Module Breakdown

The infrastructure is composed of the following decoupled libraries:

| Module | Namespace | Purpose & Tech Stack |
| :--- | :--- | :--- |
| **Composition** | `Shared.Composition` | **The Glue.** The only project that references all others. It uses Reflection to map `appsettings.json` to strongly-typed options and registers services. |
| **Caching** | `Shared.Caching` | **Distributed State.** Wraps `StackExchange.Redis`. Uniquely, it also handles **Distributed Data Protection** key persistence to ensure security keys are synchronized across pods. |
| **Security** | `Shared.Security` | **Identity & Policy.** Implements JWT Bearer Authentication, CORS policies, and Security Headers. Depends on Caching for key storage (via Composition wiring). |
| **Rate Limiting** | `Shared.RateLimiting` | **Traffic Control.** Native `Microsoft.AspNetCore.RateLimiting` middleware implementing Fixed Window and Token Bucket strategies. |
| **Web Performance** | `Shared.WebPerformance` | **Speed.** Native `OutputCache` middleware backed by Redis, enabling edge-like caching behavior on the backend. |
| **Feature Mgmt** | `Shared.FeatureManagement` | **Toggles.** Native `Microsoft.FeatureManagement` for hot-swappable feature flags without redeployment. |
| **Resilience** | `Shared.Resilience` | **Fault Tolerance.** Standard HTTP resilience pipelines (Retry, Circuit Breaker, Timeout) applied to outgoing requests. |
| **Telemetry** | `Shared.Telemetry` | **Observability.** OpenTelemetry implementation for Logs, Metrics, and Traces (OTLP/Azure Monitor). |
| **Networking** | `Shared.Networking` | **Connectivity.** Typed HTTP Clients (`ResilientClient`) pre-wired with resilience handlers. |

---

## ðŸš€ Key Features

### 1. Distributed Data Protection
In a load-balanced environment (e.g., Kubernetes), standard Data Protection keys (used for Anti-Forgery tokens and Cookie encryption) are isolated to the machine. This template solves this by automatically persisting these keys to **Redis** via the `Shared.Caching` module, allowing any pod to decrypt tokens generated by another.

### 2. Smart Configuration
Configuration is not scattered. All platform settings live under an `Infrastructure` object, while Feature Flags live at the root.

```json
"Infrastructure": {
  "Caching": { ... },
  "RateLimiting": { ... }
},
"FeatureManagement": { ... }
